{
  "version": 3,
  "sources": ["../webview-ui/src/segments.js"],
  "sourcesContent": ["/**\n * Segments View JavaScript\n * Handles all interaction logic for the segments sidebar\n */\n\n(function() {\n    const vscode = acquireVsCodeApi();\n    let segments = [];\n    let displayedSegments = []; // Sorted segments in display order\n    let currentSort = 'line'; // Default sort by line number\n    let allFiles = []; // All files with segments\n    let currentFile = null; // Currently active file\n    let collapsedFiles = new Set(); // Track which files are collapsed in All Files view\n\n    // Listen for messages from extension\n    window.addEventListener('message', event => {\n        const message = event.data;\n\n        switch (message.command) {\n            case 'updateSegments':\n                segments = message.segments;\n                allFiles = message.files || [];\n                currentFile = message.currentFile || null;\n                // Restore sort mode from backend if provided (preserves timeline view during navigation)\n                if (message.sortMode && message.sortMode !== currentSort) {\n                    currentSort = message.sortMode;\n                    // Update sort button UI to match restored mode\n                    document.querySelectorAll('.sort-button').forEach(btn => {\n                        if (btn.dataset.sort === currentSort) {\n                            btn.classList.add('active');\n                        } else {\n                            btn.classList.remove('active');\n                        }\n                    });\n                }\n                renderSegments();\n                updateFileSelector();\n                break;\n\n            case 'showFileList':\n                renderFileList(message.files);\n                break;\n\n            case 'explanationLoading':\n                updateExplanationState(message.segmentId, 'loading', message.loading);\n                break;\n\n            case 'updateExplanation':\n                updateExplanationContent(message.segmentId, message.explanation);\n                break;\n\n            case 'explanationError':\n                updateExplanationState(message.segmentId, 'error', message.error);\n                break;\n\n            case 'contextSaved':\n                // Update local segment data and hide input without re-rendering\n                handleContextSaved(message.segmentId, message.context);\n                break;\n\n            case 'highlightSegment':\n                highlightSegmentById(message.segmentId);\n                break;\n        }\n    });\n\n    function renderSegments() {\n        const container = document.getElementById('segments-list');\n        const countEl = document.getElementById('segment-count');\n\n        // Show sort controls when rendering segments\n        const sortControls = document.querySelector('.sort-controls');\n        if (sortControls) {\n            sortControls.style.display = 'flex';\n        }\n\n        // Show/hide bulk remove button\n        const bulkRemoveBtn = document.querySelector('.bulk-remove-btn');\n        if (bulkRemoveBtn) {\n            bulkRemoveBtn.style.display = segments && segments.length > 0 ? 'flex' : 'none';\n        }\n\n        // Show skeleton loaders on initial load (when segments is undefined/null)\n        if (segments === undefined || segments === null) {\n            container.innerHTML = `\n                <div class=\"skeleton-loader\">\n                    ${generateSkeletonCard()}\n                    ${generateSkeletonCard()}\n                    ${generateSkeletonCard()}\n                </div>\n            `;\n            countEl.textContent = 'Loading...';\n            return;\n        }\n\n        if (segments.length === 0) {\n            container.innerHTML = `\n                <div class=\"empty-state\">\n                    <div class=\"codicon codicon-inbox\"></div>\n                    <p>No segments detected yet.</p>\n                    <p style=\"margin-top: 8px; font-size: 12px;\">Segments will appear here as you work.</p>\n                </div>\n            `;\n            countEl.textContent = 'No segments';\n            return;\n        }\n\n        countEl.textContent = `${segments.length} segment${segments.length !== 1 ? 's' : ''}`;\n\n        // Sort segments based on current sort mode and store for auto-advance\n        displayedSegments = sortSegments([...segments], currentSort);\n\n        // Check if timeline view is active\n        const isTimelineView = currentSort === 'time';\n\n        // Check if we're in All Files mode\n        const isAllFilesMode = currentFile === '__all__';\n\n        // If in All Files mode, group segments by file for collapsible sections\n        if (isAllFilesMode) {\n            container.innerHTML = renderGroupedSegments(displayedSegments, isTimelineView);\n            return;\n        }\n\n        container.innerHTML = displayedSegments.map((segment, index) => {\n            const complexityLevel = getComplexityLevel(segment.complexity);\n            const lineCount = segment.endLine - segment.startLine + 1;\n            const isNew = isSegmentNew(segment);\n            const isStarred = segment.metadata?.isStarred || false;\n            const hasDiff = !!segment.metadata?.beforeCode;\n\n            // Flow indicator logic for timeline view\n            let flowIndicator = '';\n            if (isTimelineView && index > 0) {\n                const prevSegment = displayedSegments[index - 1];\n                const prevFilePath = prevSegment.filePath;\n                const currFilePath = segment.filePath;\n                const currFile = segment.fileName;\n\n                // Check if file changed\n                if (prevFilePath !== currFilePath) {\n                    // Check if returning to a previously edited file\n                    const isReturning = displayedSegments.slice(0, index - 1).some(s => s.filePath === currFilePath);\n\n                    if (isReturning) {\n                        flowIndicator = `\n                        <div class=\"flow-indicator flow-return\">\n                            <div class=\"flow-line\"></div>\n                            <div class=\"flow-label\">\n                                <span class=\"codicon codicon-arrow-circle-left\"></span>\n                                <span>returned to ${escapeHtml(currFile)}</span>\n                            </div>\n                        </div>`;\n                    } else {\n                        flowIndicator = `\n                        <div class=\"flow-indicator flow-switch\">\n                            <div class=\"flow-line\"></div>\n                            <div class=\"flow-label\">\n                                <span class=\"codicon codicon-arrow-right\"></span>\n                                <span>switched to ${escapeHtml(currFile)}</span>\n                            </div>\n                        </div>`;\n                    }\n                }\n            }\n\n            // Format timestamp for timeline view\n            const timeLabel = isTimelineView && segment.metadata?.detectedAt\n                ? formatTimeAgo(segment.metadata.detectedAt)\n                : '';\n\n            return `${flowIndicator}\n            <div class=\"segment-card ${isTimelineView ? 'timeline-view' : ''}\" data-segment-id=\"${segment.id}\" data-complexity=\"${complexityLevel}\" data-time=\"${segment.metadata?.detectedAt || ''}\">\n                <div class=\"segment-header\" data-clickable=\"true\">\n                    <div class=\"segment-header-left\">\n                        ${isTimelineView ? `<span class=\"timeline-order\">${index + 1}</span>` : ''}\n                        <div class=\"segment-title-wrapper\">\n                            <span class=\"segment-title\">${escapeHtml(segment.name)}</span>\n                            <span class=\"segment-subtitle\">\n                                ${escapeHtml(segment.lineRange || '')}\n                                ${isNew ? '<span class=\"new-badge\">NEW</span>' : ''}\n                                ${hasDiff ? '<span class=\"diff-badge\" title=\"Has changes from previous version\"><span class=\"codicon codicon-diff\"></span>DIFF</span>' : ''}\n                                ${timeLabel ? `<span class=\"time-badge\" title=\"${segment.metadata?.detectedAt || ''}\">${timeLabel}</span>` : ''}\n                            </span>\n                        </div>\n                    </div>\n                    <div class=\"segment-header-actions\">\n                        ${segment.metadata?.context ? `\n                        <button\n                            class=\"vk-icon-button context-indicator-btn\"\n                            title=\"Has context note\"\n                            disabled>\n                            <span class=\"codicon codicon-note\"></span>\n                        </button>\n                        ` : ''}\n                        ${segment.metadata?.beforeCode ? `\n                        <button\n                            class=\"vk-icon-button diff-btn\"\n                            title=\"Toggle diff view\"\n                            data-diff-active=\"false\"\n                            style=\"display: none;\">\n                            <span class=\"codicon codicon-diff\"></span>\n                        </button>\n                        ` : ''}\n                        ${!isTimelineView ? `\n                        <button\n                            class=\"vk-icon-button star-btn ${isStarred ? 'starred' : ''}\"\n                            title=\"Star for later\"\n                            data-starred=\"${isStarred}\">\n                            <span class=\"codicon codicon-star-${isStarred ? 'full' : 'empty'}\"></span>\n                        </button>\n                        ` : ''}\n                        <button\n                            class=\"vk-icon-button dismiss-btn\"\n                            title=\"Mark as reviewed\">\n                            <span class=\"codicon codicon-check\"></span>\n                        </button>\n                        <button\n                            class=\"vk-icon-button expand-btn\"\n                            title=\"Expand segment\"\n                            data-expanded=\"false\">\n                            <span class=\"codicon codicon-chevron-down\"></span>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"segment-body\">\n                    <!-- Compact metadata badges -->\n                    <div class=\"metadata-badges\">\n                        <span class=\"metadata-badge complexity-badge-${complexityLevel}\">\n                            <span class=\"codicon codicon-pulse\"></span>\n                            <span>${segment.complexity !== null ? segment.complexity : 'N/A'}</span>\n                        </span>\n                        <span class=\"metadata-badge\">\n                            <span class=\"codicon codicon-file-code\"></span>\n                            <span>${lineCount} lines</span>\n                        </span>\n                        <span class=\"metadata-badge\" title=\"${escapeHtml(segment.filePath)}\">\n                            <span class=\"codicon codicon-folder\"></span>\n                            <span>${escapeHtml(segment.fileName)}</span>\n                        </span>\n                    </div>\n\n                    <!-- Explanation section -->\n                    <div class=\"explanation-section\" data-segment-id=\"${segment.id}\">\n                        <!-- This will be populated dynamically by JS -->\n                    </div>\n\n                    <!-- Context section (shows saved context or hidden input) -->\n                    <div class=\"context-section ${segment.metadata?.context ? 'has-content' : ''}\" data-segment-id=\"${segment.id}\">\n                        ${segment.metadata?.context ? `\n                            <div class=\"context-display-wrapper\">\n                                <div class=\"context-display\">${escapeHtml(segment.metadata.context)}</div>\n                                <button class=\"context-menu-btn\" title=\"Edit or remove context note\">\n                                    <span class=\"codicon codicon-ellipsis\"></span>\n                                </button>\n                                <div class=\"context-menu\" style=\"display: none;\">\n                                    <button class=\"context-menu-item edit-context-menu-btn\">\n                                        <span class=\"codicon codicon-edit\"></span>\n                                        <span>Edit</span>\n                                    </button>\n                                    <button class=\"context-menu-item remove-segment-btn\">\n                                        <span class=\"codicon codicon-trash\"></span>\n                                        <span>Remove Context</span>\n                                    </button>\n                                </div>\n                            </div>\n                        ` : `\n                            <div class=\"context-input-wrapper\">\n                                <textarea class=\"context-input\" placeholder=\"Add context about this code segment...\"></textarea>\n                                <div class=\"context-actions\">\n                                    <button class=\"vk-button vk-button--primary save-context-btn\">Save</button>\n                                    <button class=\"vk-button cancel-context-btn\">Cancel</button>\n                                </div>\n                            </div>\n                        `}\n                    </div>\n\n                    <!-- Code/Diff View Section (only if beforeCode exists) -->\n                    ${segment.metadata?.beforeCode ? `\n                    <div class=\"code-diff-section\" data-segment-id=\"${segment.id}\">\n                        <!-- Will be populated with current code or diff view -->\n                    </div>\n                    ` : ''}\n\n                    <!-- Action Footer -->\n                    <div class=\"action-footer\">\n                        <div class=\"action-footer-left\">\n                            <button class=\"action-icon-btn explain-btn\" title=\"Explain this code with AI\">\n                                <span class=\"codicon codicon-sparkle\"></span>\n                            </button>\n                            <button class=\"action-icon-btn note-btn\" title=\"Add a context note\">\n                                <span class=\"codicon codicon-edit\"></span>\n                            </button>\n                            <button class=\"action-icon-btn footer-star-btn ${isStarred ? 'starred' : ''}\" title=\"${isStarred ? 'Unstar' : 'Star for later'}\" data-starred=\"${isStarred}\">\n                                <span class=\"codicon codicon-star-${isStarred ? 'full' : 'empty'}\"></span>\n                            </button>\n                        </div>\n                        <button class=\"action-icon-btn reviewed-btn\" title=\"Mark as reviewed\">\n                            <span class=\"codicon codicon-check\"></span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            `;\n        }).join('');\n    }\n\n    /**\n     * Render segments grouped by file sessions (consecutive edits in same file)\n     * This preserves timeline order while allowing collapse of each \"session\"\n     */\n    function renderGroupedSegments(segmentsToRender, isTimelineView) {\n        // Group segments by consecutive file sessions (not by file)\n        // Each time we switch to a different file, start a new session\n        const sessions = [];\n        let currentSession = null;\n        const visitedFiles = new Set();\n\n        segmentsToRender.forEach((segment, globalIndex) => {\n            const filePath = segment.filePath;\n\n            // Check if we need to start a new session\n            if (!currentSession || currentSession.filePath !== filePath) {\n                // Determine if this is a \"return\" or \"switch\"\n                const isReturn = visitedFiles.has(filePath);\n                visitedFiles.add(filePath);\n\n                currentSession = {\n                    filePath: filePath,\n                    fileName: segment.fileName,\n                    isReturn: isReturn,\n                    isFirst: sessions.length === 0,\n                    segments: [],\n                    globalIndices: [],\n                    sessionIndex: sessions.length\n                };\n                sessions.push(currentSession);\n            }\n\n            currentSession.segments.push(segment);\n            currentSession.globalIndices.push(globalIndex);\n        });\n\n        // Build HTML for each session\n        let html = '';\n        sessions.forEach((session, sessionIndex) => {\n            const sessionKey = `${session.filePath}-${sessionIndex}`;\n            const isCollapsed = collapsedFiles.has(sessionKey);\n            const segmentCount = session.segments.length;\n\n            // Determine header text and icon based on session type\n            let headerIcon, headerText, headerClass;\n            if (session.isFirst) {\n                headerIcon = 'codicon-file-code';\n                headerText = `Started in ${session.fileName}`;\n                headerClass = 'session-start';\n            } else if (session.isReturn) {\n                headerIcon = 'codicon-arrow-circle-left';\n                headerText = `Returned to ${session.fileName}`;\n                headerClass = 'session-return';\n            } else {\n                headerIcon = 'codicon-arrow-right';\n                headerText = `Switched to ${session.fileName}`;\n                headerClass = 'session-switch';\n            }\n\n            // Session group header\n            html += `\n            <div class=\"file-group ${headerClass}\" data-session-key=\"${escapeHtml(sessionKey)}\">\n                <div class=\"file-group-header ${isCollapsed ? 'collapsed' : ''}\" data-session-key=\"${escapeHtml(sessionKey)}\">\n                    <div class=\"file-group-header-left\">\n                        <span class=\"file-group-chevron codicon codicon-chevron-${isCollapsed ? 'right' : 'down'}\"></span>\n                        <span class=\"codicon ${headerIcon} file-group-icon\"></span>\n                        <span class=\"file-group-name\">${escapeHtml(headerText)}</span>\n                        <span class=\"file-group-count\">${segmentCount}</span>\n                    </div>\n                    <div class=\"file-group-header-right\">\n                        <button class=\"file-group-collapse-all-btn\" title=\"${isCollapsed ? 'Expand session' : 'Collapse session'}\">\n                            <span class=\"codicon codicon-${isCollapsed ? 'expand-all' : 'collapse-all'}\"></span>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"file-group-content ${isCollapsed ? 'collapsed' : ''}\">\n            `;\n\n            // Render segments within this session (no flow indicators needed - header shows the context)\n            session.segments.forEach((segment, indexInSession) => {\n                const globalIndex = session.globalIndices[indexInSession];\n                // Pass false for showFlowIndicator since the session header already shows this\n                html += renderSegmentCard(segment, globalIndex, isTimelineView, segmentsToRender, false);\n            });\n\n            html += `\n                </div>\n            </div>\n            `;\n        });\n\n        return html;\n    }\n\n    /**\n     * Render a single segment card (extracted for reuse)\n     * @param {boolean} showFlowIndicator - Whether to show flow indicators (false when inside session groups)\n     */\n    function renderSegmentCard(segment, index, isTimelineView, allSegments, showFlowIndicator = true) {\n        const complexityLevel = getComplexityLevel(segment.complexity);\n        const lineCount = segment.endLine - segment.startLine + 1;\n        const isNew = isSegmentNew(segment);\n        const isStarred = segment.metadata?.isStarred || false;\n        const hasDiff = !!segment.metadata?.beforeCode;\n\n        // Flow indicator logic for timeline view (only show if enabled and outside session groups)\n        let flowIndicator = '';\n        if (showFlowIndicator && isTimelineView && index > 0) {\n            const prevSegment = allSegments[index - 1];\n            const prevFilePath = prevSegment.filePath;\n            const currFilePath = segment.filePath;\n            const currFile = segment.fileName;\n\n            // Check if file changed\n            if (prevFilePath !== currFilePath) {\n                // Check if returning to a previously edited file\n                const isReturning = allSegments.slice(0, index - 1).some(s => s.filePath === currFilePath);\n\n                if (isReturning) {\n                    flowIndicator = `\n                    <div class=\"flow-indicator flow-return\">\n                        <div class=\"flow-line\"></div>\n                        <div class=\"flow-label\">\n                            <span class=\"codicon codicon-arrow-circle-left\"></span>\n                            <span>returned to ${escapeHtml(currFile)}</span>\n                        </div>\n                    </div>`;\n                } else {\n                    flowIndicator = `\n                    <div class=\"flow-indicator flow-switch\">\n                        <div class=\"flow-line\"></div>\n                        <div class=\"flow-label\">\n                            <span class=\"codicon codicon-arrow-right\"></span>\n                            <span>switched to ${escapeHtml(currFile)}</span>\n                        </div>\n                    </div>`;\n                }\n            }\n        }\n\n        // Format timestamp for timeline view\n        const timeLabel = isTimelineView && segment.metadata?.detectedAt\n            ? formatTimeAgo(segment.metadata.detectedAt)\n            : '';\n\n        return `${flowIndicator}\n        <div class=\"segment-card ${isTimelineView ? 'timeline-view' : ''}\" data-segment-id=\"${segment.id}\" data-complexity=\"${complexityLevel}\" data-time=\"${segment.metadata?.detectedAt || ''}\">\n            <div class=\"segment-header\" data-clickable=\"true\">\n                <div class=\"segment-header-left\">\n                    ${isTimelineView ? `<span class=\"timeline-order\">${index + 1}</span>` : ''}\n                    <div class=\"segment-title-wrapper\">\n                        <span class=\"segment-title\">${escapeHtml(segment.name)}</span>\n                        <span class=\"segment-subtitle\">\n                            ${escapeHtml(segment.lineRange || '')}\n                            ${isNew ? '<span class=\"new-badge\">NEW</span>' : ''}\n                            ${hasDiff ? '<span class=\"diff-badge\" title=\"Has changes from previous version\"><span class=\"codicon codicon-diff\"></span>DIFF</span>' : ''}\n                            ${timeLabel ? `<span class=\"time-badge\" title=\"${segment.metadata?.detectedAt || ''}\">${timeLabel}</span>` : ''}\n                        </span>\n                    </div>\n                </div>\n                <div class=\"segment-header-actions\">\n                    ${segment.metadata?.context ? `\n                    <button\n                        class=\"vk-icon-button context-indicator-btn\"\n                        title=\"Has context note\"\n                        disabled>\n                        <span class=\"codicon codicon-note\"></span>\n                    </button>\n                    ` : ''}\n                    ${segment.metadata?.beforeCode ? `\n                    <button\n                        class=\"vk-icon-button diff-btn\"\n                        title=\"Toggle diff view\"\n                        data-diff-active=\"false\"\n                        style=\"display: none;\">\n                        <span class=\"codicon codicon-diff\"></span>\n                    </button>\n                    ` : ''}\n                    ${!isTimelineView ? `\n                    <button\n                        class=\"vk-icon-button star-btn ${isStarred ? 'starred' : ''}\"\n                        title=\"Star for later\"\n                        data-starred=\"${isStarred}\">\n                        <span class=\"codicon codicon-star-${isStarred ? 'full' : 'empty'}\"></span>\n                    </button>\n                    ` : ''}\n                    <button\n                        class=\"vk-icon-button dismiss-btn\"\n                        title=\"Mark as reviewed\">\n                        <span class=\"codicon codicon-check\"></span>\n                    </button>\n                    <button\n                        class=\"vk-icon-button expand-btn\"\n                        title=\"Expand segment\"\n                        data-expanded=\"false\">\n                        <span class=\"codicon codicon-chevron-down\"></span>\n                    </button>\n                </div>\n            </div>\n            <div class=\"segment-body\">\n                <!-- Compact metadata badges -->\n                <div class=\"metadata-badges\">\n                    <span class=\"metadata-badge complexity-badge-${complexityLevel}\">\n                        <span class=\"codicon codicon-pulse\"></span>\n                        <span>${segment.complexity !== null ? segment.complexity : 'N/A'}</span>\n                    </span>\n                    <span class=\"metadata-badge\">\n                        <span class=\"codicon codicon-file-code\"></span>\n                        <span>${lineCount} lines</span>\n                    </span>\n                    <span class=\"metadata-badge\" title=\"${escapeHtml(segment.filePath)}\">\n                        <span class=\"codicon codicon-folder\"></span>\n                        <span>${escapeHtml(segment.fileName)}</span>\n                    </span>\n                </div>\n\n                <!-- Explanation section -->\n                <div class=\"explanation-section\" data-segment-id=\"${segment.id}\">\n                    <!-- This will be populated dynamically by JS -->\n                </div>\n\n                <!-- Context section (shows saved context or hidden input) -->\n                <div class=\"context-section ${segment.metadata?.context ? 'has-content' : ''}\" data-segment-id=\"${segment.id}\">\n                    ${segment.metadata?.context ? `\n                        <div class=\"context-display-wrapper\">\n                            <div class=\"context-display\">${escapeHtml(segment.metadata.context)}</div>\n                            <button class=\"context-menu-btn\" title=\"Edit or remove context note\">\n                                <span class=\"codicon codicon-ellipsis\"></span>\n                            </button>\n                            <div class=\"context-menu\" style=\"display: none;\">\n                                <button class=\"context-menu-item edit-context-menu-btn\">\n                                    <span class=\"codicon codicon-edit\"></span>\n                                    <span>Edit</span>\n                                </button>\n                                <button class=\"context-menu-item remove-segment-btn\">\n                                    <span class=\"codicon codicon-trash\"></span>\n                                    <span>Remove Context</span>\n                                </button>\n                            </div>\n                        </div>\n                    ` : `\n                        <div class=\"context-input-wrapper\">\n                            <textarea class=\"context-input\" placeholder=\"Add context about this code segment...\"></textarea>\n                            <div class=\"context-actions\">\n                                <button class=\"vk-button vk-button--primary save-context-btn\">Save</button>\n                                <button class=\"vk-button cancel-context-btn\">Cancel</button>\n                            </div>\n                        </div>\n                    `}\n                </div>\n\n                <!-- Code/Diff View Section (only if beforeCode exists) -->\n                ${segment.metadata?.beforeCode ? `\n                <div class=\"code-diff-section\" data-segment-id=\"${segment.id}\">\n                    <!-- Will be populated with current code or diff view -->\n                </div>\n                ` : ''}\n\n                <!-- Action Footer -->\n                <div class=\"action-footer\">\n                    <div class=\"action-footer-left\">\n                        <button class=\"action-icon-btn explain-btn\" title=\"Explain this code with AI\">\n                            <span class=\"codicon codicon-sparkle\"></span>\n                        </button>\n                        <button class=\"action-icon-btn note-btn\" title=\"Add a context note\">\n                            <span class=\"codicon codicon-edit\"></span>\n                        </button>\n                        <button class=\"action-icon-btn footer-star-btn ${isStarred ? 'starred' : ''}\" title=\"${isStarred ? 'Unstar' : 'Star for later'}\" data-starred=\"${isStarred}\">\n                            <span class=\"codicon codicon-star-${isStarred ? 'full' : 'empty'}\"></span>\n                        </button>\n                    </div>\n                    <button class=\"action-icon-btn reviewed-btn\" title=\"Mark as reviewed\">\n                        <span class=\"codicon codicon-check\"></span>\n                    </button>\n                </div>\n            </div>\n        </div>\n        `;\n    }\n\n    /**\n     * Toggle file group collapse state\n     */\n    function toggleFileGroup(filePath) {\n        if (collapsedFiles.has(filePath)) {\n            collapsedFiles.delete(filePath);\n        } else {\n            collapsedFiles.add(filePath);\n        }\n        renderSegments();\n    }\n\n    /**\n     * Collapse all file groups\n     */\n    function collapseAllFileGroups() {\n        allFiles.forEach(file => {\n            collapsedFiles.add(file.filePath);\n        });\n        renderSegments();\n    }\n\n    /**\n     * Expand all file groups\n     */\n    function expandAllFileGroups() {\n        collapsedFiles.clear();\n        renderSegments();\n    }\n\n    function toggleSegment(segmentId) {\n        const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n        if (!card) return;\n\n        const expandBtn = card.querySelector('.expand-btn');\n        const diffBtn = card.querySelector('.diff-btn');\n        const isExpanded = card.classList.contains('expanded');\n\n        if (isExpanded) {\n            // Collapse this card\n            card.classList.remove('expanded');\n            if (expandBtn) {\n                expandBtn.dataset.expanded = 'false';\n                expandBtn.title = 'Expand segment';\n            }\n            // Hide diff button when collapsed\n            if (diffBtn) {\n                diffBtn.style.display = 'none';\n            }\n        } else {\n            // Accordion behavior: collapse all other cards first\n            document.querySelectorAll('.segment-card.expanded').forEach(otherCard => {\n                if (otherCard !== card) {\n                    otherCard.classList.remove('expanded');\n                    const otherExpandBtn = otherCard.querySelector('.expand-btn');\n                    const otherDiffBtn = otherCard.querySelector('.diff-btn');\n                    if (otherExpandBtn) {\n                        otherExpandBtn.dataset.expanded = 'false';\n                        otherExpandBtn.title = 'Expand segment';\n                    }\n                    if (otherDiffBtn) {\n                        otherDiffBtn.style.display = 'none';\n                    }\n                }\n            });\n\n            // Expand this card\n            card.classList.add('expanded');\n            if (expandBtn) {\n                expandBtn.dataset.expanded = 'true';\n                expandBtn.title = 'Collapse segment';\n            }\n            // Show diff button when expanded\n            if (diffBtn) {\n                diffBtn.style.display = '';\n            }\n        }\n    }\n\n    function renderFileList(files) {\n        const container = document.getElementById('segments-list');\n        const countEl = document.getElementById('segment-count');\n\n        if (!files || files.length === 0) {\n            container.innerHTML = `\n                <div class=\"empty-state\">\n                    <div class=\"codicon codicon-inbox\"></div>\n                    <p>No segments detected yet.</p>\n                    <p style=\"margin-top: 8px; font-size: 12px;\">Segments will appear here as you work.</p>\n                </div>\n            `;\n            countEl.textContent = 'No segments';\n            return;\n        }\n\n        countEl.textContent = `${files.length} file${files.length !== 1 ? 's' : ''} with segments`;\n\n        // Hide sort controls when showing file list\n        const sortControls = document.querySelector('.sort-controls');\n        if (sortControls) {\n            sortControls.style.display = 'none';\n        }\n\n        // Build file list items\n        const fileItems = files.map((file, index) => {\n            const itemDiv = document.createElement('div');\n            itemDiv.className = 'file-list-item';\n            itemDiv.dataset.fileIndex = index;\n\n            itemDiv.innerHTML = `\n                <div class=\"file-list-item-icon\">\n                    <span class=\"codicon codicon-file-code\"></span>\n                </div>\n                <div class=\"file-list-item-content\">\n                    <div class=\"file-list-item-title\">${escapeHtml(file.fileName)}</div>\n                    <div class=\"file-list-item-subtitle\">${file.segmentCount} segment${file.segmentCount !== 1 ? 's' : ''}</div>\n                </div>\n                <div class=\"file-list-item-action\">\n                    <span class=\"codicon codicon-chevron-right\"></span>\n                </div>\n            `;\n\n            // Store file path directly on the element to avoid closure issues\n            itemDiv._filePath = file.filePath;\n\n            // Add click handler directly to element\n            itemDiv.addEventListener('click', function(e) {\n                e.stopPropagation();\n                console.log('File list item clicked:', this._filePath);\n                vscode.postMessage({\n                    command: 'openFile',\n                    filePath: this._filePath\n                });\n            });\n\n            return itemDiv;\n        });\n\n        // Clear and rebuild container\n        container.innerHTML = `\n            <div class=\"file-list-header\">\n                <div class=\"codicon codicon-info\"></div>\n                <p>No segments in current file. Click a file below to view its segments:</p>\n            </div>\n        `;\n\n        // Append file items\n        fileItems.forEach(item => container.appendChild(item));\n    }\n\n    function updateFileSelector() {\n        const selectorContainer = document.getElementById('file-selector-container');\n        const selector = document.getElementById('file-selector');\n\n        if (!allFiles || allFiles.length === 0) {\n            // No files with segments - hide selector\n            if (selectorContainer) {\n                selectorContainer.style.display = 'none';\n            }\n            return;\n        }\n\n        // Show selector when there are files\n        if (selectorContainer) {\n            selectorContainer.style.display = 'block';\n        }\n\n        // Populate selector with files\n        if (selector) {\n            // Calculate total segments across all files\n            const totalSegments = allFiles.reduce((sum, f) => sum + f.segmentCount, 0);\n\n            // Check if currently viewing all files\n            const isAllFilesMode = currentFile === '__all__';\n\n            // Build options: \"All Files\" first, then individual files\n            const allFilesOption = `<option value=\"__all__\" ${isAllFilesMode ? 'selected' : ''}>\n                All Files (${totalSegments})\n            </option>`;\n\n            const fileOptions = allFiles.map(file => {\n                const selected = !isAllFilesMode && file.isActive ? 'selected' : '';\n                return `<option value=\"${escapeHtml(file.filePath)}\" ${selected}>\n                    ${escapeHtml(file.fileName)} (${file.segmentCount})\n                </option>`;\n            }).join('');\n\n            selector.innerHTML = allFilesOption + fileOptions;\n\n            // Remove existing listener if any\n            const newSelector = selector.cloneNode(true);\n            selector.parentNode.replaceChild(newSelector, selector);\n\n            // Add change listener\n            newSelector.addEventListener('change', (e) => {\n                const selectedPath = e.target.value;\n                if (selectedPath === '__all__') {\n                    // Request all segments\n                    vscode.postMessage({\n                        command: 'showAllFiles'\n                    });\n                } else if (selectedPath) {\n                    vscode.postMessage({\n                        command: 'openFile',\n                        filePath: selectedPath\n                    });\n                }\n            });\n        }\n    }\n\n    function goToCode(segmentId, startLine) {\n        vscode.postMessage({\n            command: 'goToCode',\n            segmentId,\n            line: startLine\n        });\n    }\n\n    function saveContext(segmentId, context) {\n        vscode.postMessage({\n            command: 'saveContext',\n            segmentId,\n            context\n        });\n    }\n\n    /**\n     * Handle context saved confirmation from backend\n     * Updates local state and displays the saved context\n     */\n    function handleContextSaved(segmentId, context) {\n        // Update local segment data\n        const segment = segments.find(s => s.id === segmentId);\n        if (segment) {\n            if (!segment.metadata) {\n                segment.metadata = {};\n            }\n            segment.metadata.context = context;\n        }\n\n        // Find the context section and replace input with saved context display\n        const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n        if (card) {\n            const contextSection = card.querySelector('.context-section');\n            if (contextSection) {\n                if (context && context.trim().length > 0) {\n                    // Add has-content class for styling\n                    contextSection.classList.add('has-content');\n\n                    // Replace content with saved context display and menu button\n                    contextSection.innerHTML = `\n                        <div class=\"context-display-wrapper\">\n                            <div class=\"context-display\">${escapeHtml(context)}</div>\n                            <button class=\"context-menu-btn\" title=\"Edit or remove context note\">\n                                <span class=\"codicon codicon-ellipsis\"></span>\n                            </button>\n                            <div class=\"context-menu\" style=\"display: none;\">\n                                <button class=\"context-menu-item edit-context-menu-btn\">\n                                    <span class=\"codicon codicon-edit\"></span>\n                                    <span>Edit</span>\n                                </button>\n                                <button class=\"context-menu-item remove-segment-btn\">\n                                    <span class=\"codicon codicon-trash\"></span>\n                                    <span>Remove Context</span>\n                                </button>\n                            </div>\n                        </div>\n                    `;\n\n                    // Add context indicator button to header if not present\n                    const headerActions = card.querySelector('.segment-header-actions');\n                    if (headerActions && !headerActions.querySelector('.context-indicator-btn')) {\n                        // Insert context indicator before star button\n                        const starBtn = headerActions.querySelector('.star-btn');\n                        if (starBtn) {\n                            const contextIndicator = document.createElement('button');\n                            contextIndicator.className = 'vk-icon-button context-indicator-btn';\n                            contextIndicator.title = 'Has context note';\n                            contextIndicator.disabled = true;\n                            contextIndicator.innerHTML = '<span class=\"codicon codicon-note\"></span>';\n                            headerActions.insertBefore(contextIndicator, starBtn);\n                        }\n                    }\n                } else {\n                    // Empty context - remove indicator and reset section\n                    contextSection.classList.remove('has-content');\n                    contextSection.innerHTML = `\n                        <div class=\"context-input-wrapper\">\n                            <textarea class=\"context-input\" placeholder=\"Add context about this code segment...\"></textarea>\n                            <div class=\"context-actions\">\n                                <button class=\"vk-button vk-button--primary save-context-btn\">Save</button>\n                                <button class=\"vk-button cancel-context-btn\">Cancel</button>\n                            </div>\n                        </div>\n                    `;\n\n                    // Remove context indicator button from header\n                    const contextIndicator = card.querySelector('.context-indicator-btn');\n                    if (contextIndicator) {\n                        contextIndicator.remove();\n                    }\n                }\n            }\n        }\n    }\n\n    function explainSegment(segmentId) {\n        vscode.postMessage({\n            command: 'explainSegment',\n            segmentId\n        });\n    }\n\n    function dismissSegment(segmentId) {\n        // Find the current segment index in the DISPLAYED (sorted) order\n        const currentIndex = displayedSegments.findIndex(s => s.id === segmentId);\n\n        // Find the card element\n        const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n        if (!card) return;\n\n        // Smooth dismiss animation\n        card.classList.add('dismissing');\n\n        // Wait for animation to complete (350ms - matches CSS animation duration)\n        setTimeout(() => {\n            // Remove from DOM\n            card.remove();\n\n            // Remove from both arrays\n            segments = segments.filter(s => s.id !== segmentId);\n            displayedSegments = displayedSegments.filter(s => s.id !== segmentId);\n\n            // Update segment count\n            const countEl = document.getElementById('segment-count');\n            if (countEl) {\n                countEl.textContent = segments.length === 0\n                    ? 'No segments'\n                    : `${segments.length} segment${segments.length !== 1 ? 's' : ''}`;\n            }\n\n            // Notify backend\n            vscode.postMessage({\n                command: 'dismissSegment',\n                segmentId\n            });\n\n            // Auto-advance: Navigate to next segment in DISPLAY ORDER\n            if (displayedSegments.length > 0) {\n                // After removing current segment, if currentIndex >= length, wrap to 0\n                // Otherwise, currentIndex now points to what was the next segment\n                const nextIndex = currentIndex >= displayedSegments.length ? 0 : currentIndex;\n                const nextSegment = displayedSegments[nextIndex];\n\n                if (nextSegment) {\n                    // Tell backend to navigate to this segment\n                    vscode.postMessage({\n                        command: 'goToSegment',\n                        segmentId: nextSegment.id,\n                        startLine: nextSegment.startLine,\n                        endLine: nextSegment.endLine,\n                        filePath: nextSegment.filePath\n                    });\n                }\n            }\n        }, 350); // Smooth animation duration - matches CSS\n    }\n\n    function removeSegment(segmentId) {\n        // Force remove a segment completely, regardless of context or star status\n        const currentIndex = displayedSegments.findIndex(s => s.id === segmentId);\n\n        // Find the card element\n        const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n        if (!card) {\n            return;\n        }\n\n        // Add dismissing class to trigger animation\n        card.classList.add('dismissing');\n\n        // Wait for animation to complete before removing from DOM and notifying backend\n        setTimeout(() => {\n            // Remove from DOM\n            card.remove();\n\n            // Remove from both arrays\n            segments = segments.filter(s => s.id !== segmentId);\n            displayedSegments = displayedSegments.filter(s => s.id !== segmentId);\n\n            // Update segment count\n            const countEl = document.getElementById('segment-count');\n            if (countEl) {\n                countEl.textContent = segments.length === 0\n                    ? 'No segments'\n                    : `${segments.length} segment${segments.length !== 1 ? 's' : ''}`;\n            }\n\n            // Notify backend to force remove\n            vscode.postMessage({\n                command: 'removeSegment',\n                segmentId\n            });\n\n            // Auto-advance: Navigate to next segment in DISPLAY ORDER\n            if (displayedSegments.length > 0) {\n                const nextIndex = currentIndex >= displayedSegments.length ? 0 : currentIndex;\n                const nextSegment = displayedSegments[nextIndex];\n\n                if (nextSegment) {\n                    vscode.postMessage({\n                        command: 'goToSegment',\n                        segmentId: nextSegment.id,\n                        startLine: nextSegment.startLine,\n                        endLine: nextSegment.endLine,\n                        filePath: nextSegment.filePath\n                    });\n                }\n            }\n        }, 350); // Smooth animation duration - matches CSS\n    }\n\n    function bulkRemoveSegments() {\n        // Show subtle confirmation\n        const confirmEl = document.querySelector('.bulk-remove-confirm');\n        if (!confirmEl) return;\n\n        // Show confirmation\n        confirmEl.style.display = 'flex';\n\n        // Auto-hide after 10 seconds if no action taken\n        setTimeout(() => {\n            if (confirmEl.style.display === 'flex') {\n                confirmEl.style.display = 'none';\n            }\n        }, 10000);\n    }\n\n    function confirmBulkRemove() {\n        // Get all segment IDs\n        const allSegmentIds = segments.map(s => s.id);\n\n        // Hide confirmation\n        const confirmEl = document.querySelector('.bulk-remove-confirm');\n        if (confirmEl) {\n            confirmEl.style.display = 'none';\n        }\n\n        // Animate all cards out\n        const allCards = document.querySelectorAll('.segment-card');\n        allCards.forEach(card => card.classList.add('dismissing'));\n\n        // Wait for animation then clean up\n        setTimeout(() => {\n            // Clear arrays\n            segments = [];\n            displayedSegments = [];\n\n            // Update UI\n            const countEl = document.getElementById('segment-count');\n            if (countEl) {\n                countEl.textContent = 'No segments';\n            }\n\n            // Hide bulk remove button\n            const bulkRemoveBtn = document.querySelector('.bulk-remove-btn');\n            if (bulkRemoveBtn) {\n                bulkRemoveBtn.style.display = 'none';\n            }\n\n            // Re-render to show empty state\n            renderSegments();\n\n            // Notify backend\n            vscode.postMessage({\n                command: 'bulkRemoveSegments',\n                segmentIds: allSegmentIds\n            });\n        }, 300);\n    }\n\n    function cancelBulkRemove() {\n        const confirmEl = document.querySelector('.bulk-remove-confirm');\n        if (confirmEl) {\n            confirmEl.style.display = 'none';\n        }\n    }\n\n    function toggleStar(segmentId) {\n        // Find the segment in local state\n        const segment = segments.find(s => s.id === segmentId);\n        if (!segment) return;\n\n        // Toggle the star state\n        const newStarState = !segment.metadata?.isStarred;\n        if (!segment.metadata) {\n            segment.metadata = {};\n        }\n        segment.metadata.isStarred = newStarState;\n\n        // Update UI immediately - both header and footer star buttons\n        updateStarButtonsUI(segmentId, newStarState);\n\n        // Notify backend\n        vscode.postMessage({\n            command: 'toggleStar',\n            segmentId,\n            isStarred: newStarState\n        });\n    }\n\n    function toggleStarFromFooter(segmentId) {\n        // Same logic as toggleStar, just triggered from footer button\n        toggleStar(segmentId);\n    }\n\n    /**\n     * Update both header and footer star button UI\n     */\n    function updateStarButtonsUI(segmentId, isStarred) {\n        const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n        if (!card) return;\n\n        // Update header star button (if present - hidden in timeline view)\n        const headerStarBtn = card.querySelector('.star-btn');\n        if (headerStarBtn) {\n            const headerIcon = headerStarBtn.querySelector('.codicon');\n            headerStarBtn.dataset.starred = isStarred;\n            if (isStarred) {\n                headerStarBtn.classList.add('starred');\n                if (headerIcon) headerIcon.className = 'codicon codicon-star-full';\n            } else {\n                headerStarBtn.classList.remove('starred');\n                if (headerIcon) headerIcon.className = 'codicon codicon-star-empty';\n            }\n        }\n\n        // Update footer star button\n        const footerStarBtn = card.querySelector('.footer-star-btn');\n        if (footerStarBtn) {\n            const footerIcon = footerStarBtn.querySelector('.codicon');\n            footerStarBtn.dataset.starred = isStarred;\n            footerStarBtn.title = isStarred ? 'Unstar' : 'Star for later';\n            if (isStarred) {\n                footerStarBtn.classList.add('starred');\n                if (footerIcon) footerIcon.className = 'codicon codicon-star-full';\n            } else {\n                footerStarBtn.classList.remove('starred');\n                if (footerIcon) footerIcon.className = 'codicon codicon-star-empty';\n            }\n        }\n    }\n\n    /**\n     * Highlight a segment by ID (called when cursor is in that segment's code)\n     */\n    function highlightSegmentById(segmentId) {\n        // Remove highlight from all segments\n        document.querySelectorAll('.segment-card').forEach(card => {\n            card.classList.remove('selected');\n        });\n\n        // Add highlight to the specified segment\n        if (segmentId) {\n            const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n            if (card) {\n                card.classList.add('selected');\n            }\n        }\n    }\n\n    /**\n     * Check if a segment is new (detected within last 5 minutes)\n     */\n    function isSegmentNew(segment) {\n        if (!segment.metadata?.detectedAt) return false;\n\n        const detectedTime = new Date(segment.metadata.detectedAt).getTime();\n        const now = Date.now();\n        const fiveMinutesInMs = 5 * 60 * 1000;\n\n        return (now - detectedTime) < fiveMinutesInMs;\n    }\n\n    /**\n     * Sort segments based on selected mode\n     * Primary sort: Starred items always appear first\n     * Secondary sort: User's selected sort mode (line, complexity, or time)\n     */\n    function sortSegments(segmentsArray, sortMode) {\n        return segmentsArray.sort((a, b) => {\n            // Primary sort: Starred items first\n            const aStarred = a.metadata?.isStarred || false;\n            const bStarred = b.metadata?.isStarred || false;\n\n            if (aStarred !== bStarred) {\n                return bStarred ? 1 : -1; // Starred items come first\n            }\n\n            // Secondary sort: Apply user's selected sort mode\n            if (sortMode === 'line') {\n                // Sort by line number (ascending)\n                if (a.filePath !== b.filePath) {\n                    return a.filePath.localeCompare(b.filePath);\n                }\n                return a.startLine - b.startLine;\n            } else if (sortMode === 'complexity') {\n                // Sort by complexity (descending - highest first)\n                const complexityA = a.complexity !== null ? a.complexity : -1;\n                const complexityB = b.complexity !== null ? b.complexity : -1;\n                return complexityB - complexityA;\n            } else if (sortMode === 'time') {\n                // Sort by detection time (oldest first - chronological order)\n                const timeA = a.metadata?.detectedAt ? new Date(a.metadata.detectedAt).getTime() : 0;\n                const timeB = b.metadata?.detectedAt ? new Date(b.metadata.detectedAt).getTime() : 0;\n                return timeA - timeB;\n            }\n\n            return 0;\n        });\n    }\n\n    /**\n     * Update sort mode and re-render\n     */\n    function setSortMode(mode) {\n        currentSort = mode;\n\n        // Update button states\n        document.querySelectorAll('.sort-button').forEach(btn => {\n            if (btn.dataset.sort === mode) {\n                btn.classList.add('active');\n            } else {\n                btn.classList.remove('active');\n            }\n        });\n\n        // Notify backend of sort mode change (so it persists across updates)\n        vscode.postMessage({\n            command: 'setSortMode',\n            sortMode: mode\n        });\n\n        // Re-render with new sort\n        renderSegments();\n    }\n\n    /**\n     * Format a timestamp as relative time (e.g., \"2 min ago\", \"1 hr ago\")\n     */\n    function formatTimeAgo(isoString) {\n        if (!isoString) return '';\n\n        const date = new Date(isoString);\n        const now = Date.now();\n        const diffMs = now - date.getTime();\n\n        const seconds = Math.floor(diffMs / 1000);\n        const minutes = Math.floor(seconds / 60);\n        const hours = Math.floor(minutes / 60);\n\n        if (seconds < 60) {\n            return 'just now';\n        } else if (minutes < 60) {\n            return `${minutes}m ago`;\n        } else if (hours < 24) {\n            return `${hours}h ago`;\n        } else {\n            // Show time for older items\n            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n        }\n    }\n\n    /**\n     * Get complexity level using traffic light system\n     * Green (0-5): Low complexity\n     * Yellow/Orange (6-10): Medium complexity\n     * Red (11+): High complexity\n     */\n    function getComplexityLevel(complexity) {\n        if (complexity === null || complexity === undefined) {\n            return 'unknown';\n        }\n        if (complexity <= 5) return 'low';      // Green\n        if (complexity <= 10) return 'medium';  // Yellow/Orange\n        return 'high';                          // Red\n    }\n\n\n    function escapeHtml(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    function generateSkeletonCard() {\n        return `\n            <div class=\"skeleton-card\">\n                <div class=\"skeleton-header\">\n                    <div class=\"skeleton-title\"></div>\n                    <div class=\"skeleton-actions\">\n                        <div class=\"skeleton-icon\"></div>\n                        <div class=\"skeleton-icon\"></div>\n                        <div class=\"skeleton-icon\"></div>\n                    </div>\n                </div>\n                <div class=\"skeleton-badges\">\n                    <div class=\"skeleton-badge\"></div>\n                    <div class=\"skeleton-badge\"></div>\n                    <div class=\"skeleton-badge\"></div>\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Toggle between current code view and diff view\n     */\n    function toggleDiffView(segmentId, showDiff) {\n        const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n        if (!card) return;\n\n        const diffBtn = card.querySelector('.diff-btn');\n        const diffSection = card.querySelector('.code-diff-section');\n        const segment = segments.find(s => s.id === segmentId);\n\n        if (!diffBtn || !diffSection || !segment) return;\n\n        // Update button state\n        diffBtn.dataset.diffActive = showDiff;\n        if (showDiff) {\n            diffBtn.classList.add('active');\n            diffBtn.title = 'Show current code';\n        } else {\n            diffBtn.classList.remove('active');\n            diffBtn.title = 'Toggle diff view';\n        }\n\n        // Render appropriate view\n        if (showDiff) {\n            renderDiffView(diffSection, segment);\n        } else {\n            renderCurrentCodeView(diffSection, segment);\n        }\n    }\n\n    /**\n     * Render current code view (non-diff) - VS Code editor style\n     */\n    function renderCurrentCodeView(container, segment) {\n        const code = segment.code || '';\n        const lines = code.split('\\n');\n        const startLine = segment.startLine || 1;\n\n        // Build code lines with line numbers\n        const codeLines = lines.map((line, index) => {\n            const lineNum = startLine + index;\n            return `<div class=\"code-line\">` +\n                `<span class=\"code-line-gutter\">${lineNum}</span>` +\n                `<span class=\"code-line-content\">${escapeHtml(line) || ' '}</span>` +\n                `</div>`;\n        }).join('');\n\n        container.innerHTML = `\n            <div class=\"code-view\">\n                <div class=\"code-view-header\">\n                    <div class=\"code-view-title\">\n                        <span class=\"codicon codicon-file-code\"></span>\n                        <span class=\"code-view-label\">Current Code</span>\n                    </div>\n                    <div class=\"code-view-actions\">\n                        <button class=\"code-view-action-btn copy-code-btn\" title=\"Copy code\">\n                            <span class=\"codicon codicon-copy\"></span>\n                        </button>\n                    </div>\n                </div>\n                <div class=\"code-view-content\">\n                    ${codeLines || '<div class=\"code-view-empty\">No code content</div>'}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Render unified inline diff view with block clustering - VS Code native style\n     */\n    function renderDiffView(container, segment) {\n        if (!segment.metadata?.beforeCode) {\n            container.innerHTML = `\n                <div class=\"diff-view\">\n                    <div class=\"diff-error\">\n                        <span class=\"codicon codicon-info\"></span>\n                        <span>No previous version available for comparison</span>\n                    </div>\n                </div>\n            `;\n            return;\n        }\n\n        const beforeCode = segment.metadata.beforeCode;\n        const afterCode = segment.code || '';\n\n        // Split into lines for diff\n        const beforeLines = beforeCode.split('\\n');\n        const afterLines = afterCode.split('\\n');\n\n        // Calculate added and removed line counts and build unified view with clustering\n        let addedCount = 0;\n        let removedCount = 0;\n        const diffLines = [];\n        let oldLineNum = segment.startLine || 1;\n        let newLineNum = segment.startLine || 1;\n\n        const maxLines = Math.max(beforeLines.length, afterLines.length);\n\n        // Build change blocks - cluster removals and additions together\n        let i = 0;\n        while (i < maxLines) {\n            const beforeLine = i < beforeLines.length ? beforeLines[i] : null;\n            const afterLine = i < afterLines.length ? afterLines[i] : null;\n\n            if (beforeLine === null) {\n                // Pure addition\n                addedCount++;\n                diffLines.push(\n                    `<div class=\"diff-line added\">` +\n                    `<span class=\"diff-gutter-indicator\">+</span>` +\n                    `<span class=\"diff-line-num old\"></span>` +\n                    `<span class=\"diff-line-num new\">${newLineNum}</span>` +\n                    `<span class=\"diff-content\">${escapeHtml(afterLine) || ' '}</span>` +\n                    `</div>`\n                );\n                newLineNum++;\n                i++;\n            } else if (afterLine === null) {\n                // Pure deletion\n                removedCount++;\n                diffLines.push(\n                    `<div class=\"diff-line removed\">` +\n                    `<span class=\"diff-gutter-indicator\">\u2212</span>` +\n                    `<span class=\"diff-line-num old\">${oldLineNum}</span>` +\n                    `<span class=\"diff-line-num new\"></span>` +\n                    `<span class=\"diff-content\">${escapeHtml(beforeLine) || ' '}</span>` +\n                    `</div>`\n                );\n                oldLineNum++;\n                i++;\n            } else if (beforeLine !== afterLine) {\n                // Changed block - collect all changed lines together\n                const removedBlock = [];\n                const addedBlock = [];\n                let j = i;\n\n                // Collect consecutive changed lines\n                while (j < maxLines) {\n                    const b = j < beforeLines.length ? beforeLines[j] : null;\n                    const a = j < afterLines.length ? afterLines[j] : null;\n\n                    if (b === a || b === null || a === null) {\n                        break; // Stop at context or pure add/remove\n                    }\n\n                    removedBlock.push({ line: b, num: oldLineNum + (j - i) });\n                    addedBlock.push({ line: a, num: newLineNum + (j - i) });\n                    j++;\n                }\n\n                // If we collected any changed lines, render them as blocks\n                if (removedBlock.length > 0) {\n                    // All removals first (grouped)\n                    removedBlock.forEach((item, idx) => {\n                        removedCount++;\n                        diffLines.push(\n                            `<div class=\"diff-line removed\">` +\n                            `<span class=\"diff-gutter-indicator\">\u2212</span>` +\n                            `<span class=\"diff-line-num old\">${oldLineNum + idx}</span>` +\n                            `<span class=\"diff-line-num new\"></span>` +\n                            `<span class=\"diff-content\">${escapeHtml(item.line) || ' '}</span>` +\n                            `</div>`\n                        );\n                    });\n                    // Then all additions (grouped)\n                    addedBlock.forEach((item, idx) => {\n                        addedCount++;\n                        diffLines.push(\n                            `<div class=\"diff-line added\">` +\n                            `<span class=\"diff-gutter-indicator\">+</span>` +\n                            `<span class=\"diff-line-num old\"></span>` +\n                            `<span class=\"diff-line-num new\">${newLineNum + idx}</span>` +\n                            `<span class=\"diff-content\">${escapeHtml(item.line) || ' '}</span>` +\n                            `</div>`\n                        );\n                    });\n                    oldLineNum += removedBlock.length;\n                    newLineNum += addedBlock.length;\n                    i = j;\n                } else {\n                    // Fallback for single line change\n                    removedCount++;\n                    addedCount++;\n                    diffLines.push(\n                        `<div class=\"diff-line removed\">` +\n                        `<span class=\"diff-gutter-indicator\">\u2212</span>` +\n                        `<span class=\"diff-line-num old\">${oldLineNum}</span>` +\n                        `<span class=\"diff-line-num new\"></span>` +\n                        `<span class=\"diff-content\">${escapeHtml(beforeLine) || ' '}</span>` +\n                        `</div>`\n                    );\n                    diffLines.push(\n                        `<div class=\"diff-line added\">` +\n                        `<span class=\"diff-gutter-indicator\">+</span>` +\n                        `<span class=\"diff-line-num old\"></span>` +\n                        `<span class=\"diff-line-num new\">${newLineNum}</span>` +\n                        `<span class=\"diff-content\">${escapeHtml(afterLine) || ' '}</span>` +\n                        `</div>`\n                    );\n                    oldLineNum++;\n                    newLineNum++;\n                    i++;\n                }\n            } else {\n                // Unchanged context line\n                diffLines.push(\n                    `<div class=\"diff-line context\">` +\n                    `<span class=\"diff-gutter-indicator\"></span>` +\n                    `<span class=\"diff-line-num old\">${oldLineNum}</span>` +\n                    `<span class=\"diff-line-num new\">${newLineNum}</span>` +\n                    `<span class=\"diff-content\">${escapeHtml(afterLine) || ' '}</span>` +\n                    `</div>`\n                );\n                oldLineNum++;\n                newLineNum++;\n                i++;\n            }\n        }\n\n        container.innerHTML = `\n            <div class=\"diff-view\">\n                <div class=\"diff-view-header\">\n                    <div class=\"diff-view-title\">\n                        <span class=\"codicon codicon-diff\"></span>\n                        <span class=\"diff-view-label\">Changes</span>\n                    </div>\n                    <div class=\"diff-stats\">\n                        <span class=\"diff-stat-add\">+${addedCount}</span>\n                        <span class=\"diff-stat-remove\">\u2212${removedCount}</span>\n                    </div>\n                </div>\n                <div class=\"diff-view-content\">\n                    ${diffLines.join('')}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Render markdown content using marked.js library\n     */\n    function renderMarkdown(markdown) {\n        if (!markdown) return '';\n\n        // Wait for marked to be loaded\n        if (typeof marked === 'undefined') {\n            console.warn('marked.js not loaded yet, returning plain text');\n            return escapeHtml(markdown);\n        }\n\n        try {\n            // Configure marked options for better rendering\n            marked.setOptions({\n                breaks: true,        // Convert \\n to <br>\n                gfm: true,          // GitHub Flavored Markdown\n                headerIds: false,   // Don't add IDs to headers\n                mangle: false       // Don't mangle email addresses\n            });\n\n            return marked.parse(markdown);\n        } catch (error) {\n            console.error('Error rendering markdown:', error);\n            return escapeHtml(markdown);\n        }\n    }\n\n    /**\n     * Update explanation section with loading/error state\n     */\n    function updateExplanationState(segmentId, state, data) {\n        const section = document.querySelector(`.explanation-section[data-segment-id=\"${segmentId}\"]`);\n        if (!section) return;\n\n        if (state === 'loading') {\n            if (data) {\n                section.className = 'explanation-section loading';\n                section.innerHTML = `\n                    <div class=\"explanation-loading\">\n                        <div class=\"loading-spinner\"></div>\n                        <span>Generating explanation...</span>\n                    </div>\n                `;\n            } else {\n                // Clear loading if data is false\n                if (!section.classList.contains('has-content')) {\n                    section.innerHTML = '';\n                    section.className = 'explanation-section';\n                }\n            }\n        } else if (state === 'error') {\n            section.className = 'explanation-section error';\n            section.innerHTML = `\n                <div class=\"explanation-error\">\n                    <span class=\"codicon codicon-warning\"></span>\n                    <div>\n                        <div>${escapeHtml(data)}</div>\n                        <div class=\"explanation-actions\">\n                            <button class=\"regenerate-btn\" data-segment-id=\"${segmentId}\">\n                                <span class=\"codicon codicon-refresh\"></span>\n                                <span>Retry</span>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Update explanation section with content\n     */\n    function updateExplanationContent(segmentId, explanation) {\n        const section = document.querySelector(`.explanation-section[data-segment-id=\"${segmentId}\"]`);\n        if (!section) return;\n\n        section.className = 'explanation-section has-content';\n        section.innerHTML = `\n            <div class=\"explanation-header\" data-segment-id=\"${segmentId}\">\n                <div class=\"explanation-label\">\n                    <span class=\"codicon codicon-lightbulb\"></span>\n                    <span>AI Explanation</span>\n                </div>\n                <div class=\"explanation-toggle\">\n                    <button class=\"regenerate-btn\" data-segment-id=\"${segmentId}\">\n                        <span class=\"codicon codicon-refresh\"></span>\n                        <span>Regenerate</span>\n                    </button>\n                    <div class=\"collapse-icon\">\n                        <span class=\"codicon codicon-remove\"></span>\n                    </div>\n                </div>\n            </div>\n            <div class=\"explanation-body\">\n                <div class=\"explanation-content\">\n                    ${renderMarkdown(explanation)}\n                </div>\n            </div>\n        `;\n\n        // Update segment metadata for persistence\n        const segment = segments.find(function(s) { return s.id === segmentId; });\n        if (segment) {\n            if (!segment.metadata) {\n                segment.metadata = {};\n            }\n            segment.metadata.explanation = explanation;\n        }\n    }\n\n    // Event delegation for all clicks\n    document.addEventListener('click', function(e) {\n        const target = e.target;\n\n        // Close any open context menus when clicking outside\n        if (!target.closest('.context-menu-btn') && !target.closest('.context-menu')) {\n            const openMenus = document.querySelectorAll('.context-menu');\n            openMenus.forEach(menu => {\n                menu.style.display = 'none';\n            });\n        }\n\n        // Handle sort buttons\n        const sortBtn = target.closest('.sort-button');\n        if (sortBtn) {\n            const sortMode = sortBtn.dataset.sort;\n            if (sortMode) {\n                e.preventDefault();\n                setSortMode(sortMode);\n            }\n            return;\n        }\n\n        // Handle file group header click (collapse/expand)\n        const fileGroupHeader = target.closest('.file-group-header');\n        if (fileGroupHeader) {\n            // Support both sessionKey (new) and filePath (legacy) for backwards compatibility\n            const sessionKey = fileGroupHeader.dataset.sessionKey || fileGroupHeader.dataset.filePath;\n            if (sessionKey) {\n                e.preventDefault();\n                toggleFileGroup(sessionKey);\n            }\n            return;\n        }\n\n        // Handle title/subtitle click to navigate to code\n        const title = target.closest('.segment-title');\n        const subtitle = target.closest('.segment-subtitle');\n        if (title || subtitle) {\n            const card = target.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                e.stopPropagation();\n                const segmentId = card.dataset.segmentId;\n                const segment = segments.find(s => s.id === segmentId);\n                if (segment) {\n                    goToCode(segmentId, segment.startLine);\n                }\n            }\n            return;\n        }\n\n        // Handle header click to expand/collapse (but not if clicking on buttons or title)\n        const header = target.closest('.segment-header[data-clickable=\"true\"]');\n        if (header && !target.closest('button') && !target.closest('.segment-title') && !target.closest('.segment-subtitle')) {\n            const card = header.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                const segmentId = card.dataset.segmentId;\n                toggleSegment(segmentId);\n            }\n            return;\n        }\n\n        // Handle expand/collapse button\n        const expandBtn = target.closest('.expand-btn');\n        if (expandBtn) {\n            const segmentId = expandBtn.closest('[data-segment-id]')?.dataset.segmentId;\n            if (segmentId) {\n                e.preventDefault();\n                e.stopPropagation();\n                toggleSegment(segmentId);\n            }\n            return;\n        }\n\n        // Handle Add Context button\n        const addContextBtn = target.closest('.add-context-btn');\n        if (addContextBtn) {\n            const contextSection = addContextBtn.closest('.context-section');\n            if (contextSection) {\n                e.preventDefault();\n                const btn = contextSection.querySelector('.add-context-btn');\n                const wrapper = contextSection.querySelector('.context-input-wrapper');\n                if (btn && wrapper) {\n                    btn.style.display = 'none';\n                    wrapper.classList.add('visible');\n                    const textarea = wrapper.querySelector('.context-input');\n                    if (textarea) {\n                        setTimeout(() => textarea.focus(), 100);\n                    }\n                }\n            }\n            return;\n        }\n\n        // Handle Cancel Add Context button\n        const cancelAddContextBtn = target.closest('.cancel-add-context-btn');\n        if (cancelAddContextBtn) {\n            const contextSection = cancelAddContextBtn.closest('.context-section');\n            if (contextSection) {\n                e.preventDefault();\n                const btn = contextSection.querySelector('.add-context-btn');\n                const wrapper = contextSection.querySelector('.context-input-wrapper');\n                if (btn && wrapper) {\n                    btn.style.display = '';\n                    wrapper.classList.remove('visible');\n                    const textarea = wrapper.querySelector('.context-input');\n                    if (textarea) {\n                        textarea.value = '';\n                    }\n                }\n            }\n            return;\n        }\n\n        // Handle Save Context button\n        const saveContextBtn = target.closest('.save-context-btn');\n        if (saveContextBtn) {\n            const contextSection = saveContextBtn.closest('.context-section');\n            if (contextSection) {\n                const segmentId = contextSection.dataset.segmentId;\n                const textarea = contextSection.querySelector('.context-input');\n                if (textarea && segmentId) {\n                    e.preventDefault();\n                    saveContext(segmentId, textarea.value);\n                }\n            }\n            return;\n        }\n\n        // Handle Edit Context button\n        const editContextBtn = target.closest('.edit-context-btn');\n        if (editContextBtn) {\n            const contextSection = editContextBtn.closest('.context-section');\n            if (contextSection) {\n                const segmentId = contextSection.dataset.segmentId;\n                const segment = segments.find(s => s.id === segmentId);\n                if (segment) {\n                    e.preventDefault();\n                    contextSection.classList.remove('has-content');\n                    contextSection.innerHTML = `\n                        <div class=\"context-header\">\n                            <div class=\"context-label\">Context</div>\n                        </div>\n                        <div class=\"context-input-wrapper visible\">\n                            <textarea\n                                class=\"context-input\"\n                                placeholder=\"What does this code do? Why is it important?\"\n                                data-segment-id=\"${segmentId}\">${segment.metadata?.context || ''}</textarea>\n                            <div class=\"context-actions\">\n                                <button class=\"vk-button vk-button--secondary cancel-context-btn\">\n                                    <span>Cancel</span>\n                                </button>\n                                <button class=\"vk-button vk-button--primary save-context-btn\">\n                                    <span class=\"codicon codicon-save\"></span>\n                                    <span>Save</span>\n                                </button>\n                            </div>\n                        </div>\n                    `;\n                    const textarea = contextSection.querySelector('.context-input');\n                    if (textarea) {\n                        setTimeout(() => textarea.focus(), 100);\n                    }\n                }\n            }\n            return;\n        }\n\n        // Handle Cancel Context button\n        const cancelContextBtn = target.closest('.cancel-context-btn');\n        if (cancelContextBtn) {\n            const contextSection = cancelContextBtn.closest('.context-section');\n            if (contextSection) {\n                e.preventDefault();\n                const segmentId = contextSection.dataset.segmentId;\n                const segment = segments.find(s => s.id === segmentId);\n\n                if (segment && segment.metadata?.context) {\n                    // Restore saved context display with menu button\n                    contextSection.classList.add('has-content');\n                    contextSection.innerHTML = `\n                        <div class=\"context-display-wrapper\">\n                            <div class=\"context-display\">${escapeHtml(segment.metadata.context)}</div>\n                            <button class=\"context-menu-btn\" title=\"Edit or remove context note\">\n                                <span class=\"codicon codicon-ellipsis\"></span>\n                            </button>\n                            <div class=\"context-menu\" style=\"display: none;\">\n                                <button class=\"context-menu-item edit-context-menu-btn\">\n                                    <span class=\"codicon codicon-edit\"></span>\n                                    <span>Edit</span>\n                                </button>\n                                <button class=\"context-menu-item remove-segment-btn\">\n                                    <span class=\"codicon codicon-trash\"></span>\n                                    <span>Remove Context</span>\n                                </button>\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    // No existing context, hide the section completely\n                    contextSection.style.display = 'none';\n                    const wrapper = contextSection.querySelector('.context-input-wrapper');\n                    if (wrapper) {\n                        wrapper.classList.remove('visible');\n                        const textarea = wrapper.querySelector('.context-input');\n                        if (textarea) {\n                            textarea.value = '';\n                        }\n                    }\n                }\n            }\n            return;\n        }\n\n        // Handle Context Menu Button\n        const contextMenuBtn = target.closest('.context-menu-btn');\n        if (contextMenuBtn) {\n            e.preventDefault();\n            const menu = contextMenuBtn.nextElementSibling;\n            if (menu && menu.classList.contains('context-menu')) {\n                const isVisible = menu.style.display !== 'none';\n                menu.style.display = isVisible ? 'none' : 'block';\n            }\n            return;\n        }\n\n        // Handle Edit Context Menu Item\n        const editContextMenuBtn = target.closest('.edit-context-menu-btn');\n        if (editContextMenuBtn) {\n            const contextSection = editContextMenuBtn.closest('.context-section');\n            if (contextSection) {\n                e.preventDefault();\n                const segmentId = contextSection.dataset.segmentId;\n                const segment = segments.find(s => s.id === segmentId);\n\n                // Hide the menu\n                const menu = contextSection.querySelector('.context-menu');\n                if (menu) {\n                    menu.style.display = 'none';\n                }\n\n                // Get existing context text\n                const existingContext = segment?.metadata?.context || '';\n\n                // Show edit mode\n                contextSection.classList.remove('has-content');\n                contextSection.innerHTML = `\n                    <div class=\"context-input-wrapper visible\">\n                        <textarea class=\"context-input\" placeholder=\"Add context about this code segment...\">${escapeHtml(existingContext)}</textarea>\n                        <div class=\"context-actions\">\n                            <button class=\"vk-button cancel-context-btn\">Cancel</button>\n                            <button class=\"vk-button vk-button--primary save-context-btn\">Save</button>\n                        </div>\n                    </div>\n                `;\n                const textarea = contextSection.querySelector('.context-input');\n                if (textarea) {\n                    setTimeout(() => textarea.focus(), 100);\n                }\n            }\n            return;\n        }\n\n        // Handle Remove Context Menu Item\n        const removeSegmentBtn = target.closest('.remove-segment-btn');\n        if (removeSegmentBtn) {\n            const contextSection = removeSegmentBtn.closest('.context-section');\n            if (contextSection) {\n                const segmentId = contextSection.dataset.segmentId;\n                if (segmentId) {\n                    e.preventDefault();\n                    // Hide the menu\n                    const menu = contextSection.querySelector('.context-menu');\n                    if (menu) {\n                        menu.style.display = 'none';\n                    }\n\n                    // Remove only the context note, not the entire segment\n                    const segment = segments.find(s => s.id === segmentId);\n                    if (segment && segment.metadata) {\n                        segment.metadata.context = '';\n                    }\n\n                    // Save empty context to backend\n                    saveContext(segmentId, '');\n\n                    // Update UI to hide context section\n                    contextSection.classList.remove('has-content');\n                    contextSection.innerHTML = `\n                        <div class=\"context-input-wrapper\">\n                            <textarea class=\"context-input\" placeholder=\"Add context about this code segment...\"></textarea>\n                            <div class=\"context-actions\">\n                                <button class=\"vk-button vk-button--primary save-context-btn\">Save</button>\n                                <button class=\"vk-button cancel-context-btn\">Cancel</button>\n                            </div>\n                        </div>\n                    `;\n\n                    // Remove context indicator button from header\n                    const card = document.querySelector(`.segment-card[data-segment-id=\"${segmentId}\"]`);\n                    if (card) {\n                        const contextIndicator = card.querySelector('.context-indicator-btn');\n                        if (contextIndicator) {\n                            contextIndicator.remove();\n                        }\n                    }\n                }\n            }\n            return;\n        }\n\n        // Handle Explain button (in action footer)\n        const explainBtn = target.closest('.explain-btn');\n        if (explainBtn) {\n            const card = explainBtn.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                explainSegment(card.dataset.segmentId);\n            }\n            return;\n        }\n\n        // Handle Note button (in action footer) - Edit context\n        const noteBtn = target.closest('.note-btn');\n        if (noteBtn) {\n            const card = noteBtn.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                const segmentId = card.dataset.segmentId;\n                const segment = segments.find(s => s.id === segmentId);\n\n                // First, expand the segment if it's not already expanded\n                if (!card.classList.contains('expanded')) {\n                    toggleSegment(segmentId);\n                }\n\n                // Wait a bit for expansion animation, then show context input\n                setTimeout(() => {\n                    const contextSection = card.querySelector('.context-section');\n                    if (contextSection) {\n                        // If there's saved context, show edit mode with existing text\n                        if (segment && segment.metadata?.context) {\n                            contextSection.classList.remove('has-content');\n                            contextSection.innerHTML = `\n                                <div class=\"context-input-wrapper visible\">\n                                    <textarea class=\"context-input\" placeholder=\"Add context about this code segment...\">${escapeHtml(segment.metadata.context)}</textarea>\n                                    <div class=\"context-actions\">\n                                        <button class=\"vk-button vk-button--primary save-context-btn\">Save</button>\n                                        <button class=\"vk-button cancel-context-btn\">Cancel</button>\n                                    </div>\n                                </div>\n                            `;\n                        } else {\n                            // No saved context, show empty input\n                            // First make the section visible, then show the wrapper\n                            contextSection.style.display = 'block';\n                            const wrapper = contextSection.querySelector('.context-input-wrapper');\n                            if (wrapper) {\n                                wrapper.classList.add('visible');\n                            }\n                        }\n\n                        const textarea = contextSection.querySelector('.context-input');\n                        if (textarea) {\n                            setTimeout(() => textarea.focus(), 100);\n                        }\n                    }\n                }, 150);\n            }\n            return;\n        }\n\n        // Handle Reviewed button (in action footer)\n        const reviewedBtn = target.closest('.reviewed-btn');\n        if (reviewedBtn) {\n            const card = reviewedBtn.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                const segmentId = card.dataset.segmentId;\n                dismissSegment(segmentId);\n            }\n            return;\n        }\n\n        // Handle Star button (header)\n        const starBtn = target.closest('.star-btn');\n        if (starBtn) {\n            const card = starBtn.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                const segmentId = card.dataset.segmentId;\n                toggleStar(segmentId);\n            }\n            return;\n        }\n\n        // Handle Star button (footer - in expanded view)\n        const footerStarBtn = target.closest('.footer-star-btn');\n        if (footerStarBtn) {\n            const card = footerStarBtn.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                const segmentId = card.dataset.segmentId;\n                toggleStarFromFooter(segmentId);\n            }\n            return;\n        }\n\n        // Handle Dismiss button\n        const dismissBtn = target.closest('.dismiss-btn');\n        if (dismissBtn) {\n            const card = dismissBtn.closest('[data-segment-id]');\n            if (card) {\n                e.preventDefault();\n                const segmentId = card.dataset.segmentId;\n                dismissSegment(segmentId);\n            }\n            return;\n        }\n\n        // Handle Regenerate explanation button\n        const regenerateBtn = target.closest('.regenerate-btn');\n        if (regenerateBtn && regenerateBtn.dataset.segmentId) {\n            e.preventDefault();\n            e.stopPropagation();\n            explainSegment(regenerateBtn.dataset.segmentId);\n            return;\n        }\n\n        // Handle Explanation collapse/expand\n        const explanationHeader = target.closest('.explanation-header');\n        if (explanationHeader) {\n            const section = explanationHeader.closest('.explanation-section');\n            if (section && section.classList.contains('has-content')) {\n                e.preventDefault();\n                section.classList.toggle('collapsed');\n\n                // Update icon\n                const icon = section.querySelector('.collapse-icon .codicon');\n                if (icon) {\n                    if (section.classList.contains('collapsed')) {\n                        icon.className = 'codicon codicon-add';\n                    } else {\n                        icon.className = 'codicon codicon-remove';\n                    }\n                }\n            }\n            return;\n        }\n\n        // Handle Diff button\n        const diffBtn = target.closest('.diff-btn');\n        if (diffBtn) {\n            e.preventDefault();\n            const card = diffBtn.closest('[data-segment-id]');\n            if (card) {\n                const segmentId = card.dataset.segmentId;\n                const isDiffActive = diffBtn.dataset.diffActive === 'true';\n                toggleDiffView(segmentId, !isDiffActive);\n            }\n            return;\n        }\n\n        // Handle Bulk Remove button\n        const bulkRemoveBtn = target.closest('.bulk-remove-btn');\n        if (bulkRemoveBtn) {\n            e.preventDefault();\n            bulkRemoveSegments();\n            return;\n        }\n\n        // Handle Confirm Bulk Remove button\n        const confirmBtn = target.closest('.confirm-bulk-remove-btn');\n        if (confirmBtn) {\n            e.preventDefault();\n            confirmBulkRemove();\n            return;\n        }\n\n        // Handle Cancel Bulk Remove button\n        const cancelBtn = target.closest('.cancel-bulk-remove-btn');\n        if (cancelBtn) {\n            e.preventDefault();\n            cancelBulkRemove();\n            return;\n        }\n    });\n\n    // Request initial data\n    vscode.postMessage({ command: 'refresh' });\n})();\n"],
  "mappings": "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",
  "names": []
}
